{
  "openapi": "3.0.0",
  "info": {
    "title": "BAGBOT Trading Bot API",
    "version": "1.0.0",
    "description": "Backend API for BAGBOT cryptocurrency trading bot"
  },
  "servers": [
    {
      "url": "https://bagbot2-backend.onrender.com",
      "description": "Production server"
    },
    {
      "url": "http://localhost:8000",
      "description": "Local development"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "summary": "Root health check",
        "tags": ["health"],
        "responses": {
          "200": {
            "description": "Service is running",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string", "example": "ok" },
                    "service": { "type": "string", "example": "bagbot backend" }
                  },
                  "required": ["status", "service"]
                }
              }
            }
          }
        }
      }
    },
    "/api/health": {
      "get": {
        "summary": "API health check",
        "tags": ["health"],
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string", "example": "api healthy" }
                  },
                  "required": ["status"]
                }
              }
            }
          }
        }
      }
    },
    "/api/worker/status": {
      "get": {
        "summary": "Get worker status",
        "tags": ["worker"],
        "responses": {
          "200": {
            "description": "Worker status retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { 
                      "type": "string", 
                      "enum": ["running", "stopped"],
                      "example": "running"
                    },
                    "thread_id": {
                      "type": "integer",
                      "description": "Thread ID when running",
                      "example": 123456
                    },
                    "uptime": {
                      "type": "string",
                      "description": "Uptime duration (future enhancement)",
                      "example": "2h 15m"
                    }
                  },
                  "required": ["status"]
                }
              }
            }
          }
        }
      }
    },
    "/api/worker/start": {
      "post": {
        "summary": "Start the trading worker",
        "tags": ["worker"],
        "responses": {
          "200": {
            "description": "Worker started or already running",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { 
                      "type": "string",
                      "enum": ["worker started", "worker already running"],
                      "example": "worker started"
                    }
                  },
                  "required": ["status"]
                }
              }
            }
          }
        }
      }
    },
    "/api/worker/stop": {
      "post": {
        "summary": "Stop the trading worker",
        "tags": ["worker"],
        "responses": {
          "200": {
            "description": "Worker stopped or not running",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { 
                      "type": "string",
                      "enum": ["worker stopped", "worker not running"],
                      "example": "worker stopped"
                    }
                  },
                  "required": ["status"]
                }
              }
            }
          }
        }
      }
    },
    "/jobs": {
      "post": {
        "summary": "Submit a job to the worker queue",
        "tags": ["jobs"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "job_type": {
                    "type": "string",
                    "enum": ["OPTIMIZE", "BACKTEST", "TRAIN"],
                    "example": "OPTIMIZE"
                  },
                  "payload": {
                    "type": "object",
                    "description": "Job-specific parameters",
                    "example": {
                      "data_file": "tests/data/BTCSTUSDT-1h-merged.csv",
                      "objective": "sharpe",
                      "population": 20,
                      "generations": 10
                    }
                  }
                },
                "required": ["job_type", "payload"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Job queued successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string", "example": "queued" },
                    "job_id": { "type": "string", "example": "job_abc123" }
                  },
                  "required": ["status", "job_id"]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": { "type": "string", "example": "Invalid job_type: INVALID" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/trades": {
      "get": {
        "summary": "Get recent trades (planned endpoint)",
        "tags": ["trading"],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "default": 50 },
            "description": "Number of trades to return"
          },
          {
            "name": "strategy",
            "in": "query",
            "schema": { "type": "string" },
            "description": "Filter by strategy name"
          }
        ],
        "responses": {
          "200": {
            "description": "List of trades",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "trades": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "timestamp": { "type": "string", "format": "date-time" },
                          "pair": { "type": "string", "example": "BTC/USDT" },
                          "side": { "type": "string", "enum": ["BUY", "SELL"] },
                          "price": { "type": "number" },
                          "amount": { "type": "number" },
                          "profit": { "type": "number" },
                          "strategy": { "type": "string" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    },
    "/api/signals": {
      "get": {
        "summary": "Get recent trading signals (planned endpoint)",
        "tags": ["trading"],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "default": 20 }
          }
        ],
        "responses": {
          "200": {
            "description": "List of signals",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "signals": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "timestamp": { "type": "string", "format": "date-time" },
                          "pair": { "type": "string" },
                          "signal": { "type": "string", "enum": ["BUY", "SELL", "HOLD"] },
                          "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
                          "price": { "type": "number" },
                          "indicators": { "type": "object" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    },
    "/api/metrics": {
      "get": {
        "summary": "Get performance metrics (planned endpoint)",
        "tags": ["analytics"],
        "responses": {
          "200": {
            "description": "Trading metrics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "total_trades": { "type": "integer" },
                    "win_rate": { "type": "number" },
                    "profit_today": { "type": "number" },
                    "active_positions": { "type": "integer" },
                    "total_pnl": { "type": "number" },
                    "sharpe_ratio": { "type": "number" },
                    "max_drawdown": { "type": "number" }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    },
    "/api/optimizer/run": {
      "post": {
        "summary": "Run genetic optimizer (planned endpoint)",
        "tags": ["optimizer"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "data_file": { "type": "string" },
                  "objective": { 
                    "type": "string", 
                    "enum": ["sharpe", "total_return", "win_rate"]
                  },
                  "population": { "type": "integer", "minimum": 4 },
                  "generations": { "type": "integer", "minimum": 1 },
                  "seed": { "type": "integer" }
                },
                "required": ["data_file", "objective", "population", "generations"]
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Optimization started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": { "type": "string" },
                    "status": { "type": "string", "example": "running" }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    },
    "/api/backtest/run": {
      "post": {
        "summary": "Run backtest (planned endpoint)",
        "tags": ["backtest"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "data_file": { "type": "string" },
                  "genome_file": { "type": "string" },
                  "initial_balance": { "type": "number" },
                  "fee_rate": { "type": "number" }
                },
                "required": ["data_file", "genome_file"]
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Backtest started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": { "type": "string" },
                    "status": { "type": "string", "example": "running" }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    },
    "/api/chart/data": {
      "get": {
        "summary": "Get chart data for visualization (planned endpoint)",
        "tags": ["charts"],
        "parameters": [
          {
            "name": "pair",
            "in": "query",
            "required": true,
            "schema": { "type": "string", "example": "BTC/USDT" }
          },
          {
            "name": "timeframe",
            "in": "query",
            "schema": { "type": "string", "default": "1h" }
          },
          {
            "name": "start",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          },
          {
            "name": "end",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" }
          }
        ],
        "responses": {
          "200": {
            "description": "OHLCV data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": { "type": "string" },
                          "open": { "type": "number" },
                          "high": { "type": "number" },
                          "low": { "type": "number" },
                          "close": { "type": "number" },
                          "volume": { "type": "number" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented yet"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "detail": { "type": "string" },
          "error": { "type": "string" }
        }
      }
    },
    "headers": {
      "X-Request-ID": {
        "description": "Unique request identifier for tracing",
        "schema": { "type": "string" }
      }
    }
  },
  "tags": [
    { "name": "health", "description": "Health check endpoints" },
    { "name": "worker", "description": "Worker control endpoints" },
    { "name": "jobs", "description": "Job queue management" },
    { "name": "trading", "description": "Trading operations" },
    { "name": "analytics", "description": "Performance analytics" },
    { "name": "optimizer", "description": "Strategy optimization" },
    { "name": "backtest", "description": "Backtesting" },
    { "name": "charts", "description": "Chart data" }
  ]
}
